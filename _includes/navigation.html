<nav id="navigation">
    {% assign first_level_pages = "" | split, "" %}
    {% assign second_level_pages = "" | split, "" %}
    {% assign third_level_pages = "" | split, "" %}

    {% for p in site.pages %}
        {%- assign p_tree = p.url | remove_first: "/" | split: "/" -%}
        {%- assign p_name = p_tree | last -%}
        {%- assign p_level = p_tree | size -%}

        {% if p.bookmark == nil and p_name != 'index.html' %}
            {% continue %}
        {% endif %}

        {% if p.bookmark %}
            {% if p_level == 1 %}
                {% assign first_level_pages = first_level_pages | push:p %}
            {% elsif p_level == 2 %}
                {% assign second_level_pages = second_level_pages | push:p %}
            {% elsif p_level == 3 %}
                {% assign third_level_pages = third_level_pages | push:p %}
            {% endif %}
        {% else %}
            {% if p_level <= 2 %}
                {% assign first_level_pages = first_level_pages | push:p %}
            {% elsif p_level == 3 %}
                {% assign second_level_pages = second_level_pages | push:p %}
            {% elsif p_level == 4 %}
                {% assign third_level_pages = third_level_pages | push:p %}
            {% endif %}
        {% endif %}
    {% endfor %}

    {% assign first_level_pages = first_level_pages | sort: 'url' %}
    {% assign second_level_pages = second_level_pages | sort: 'url' %}
    {% assign third_level_pages = third_level_pages | sort: 'url' %}

    <ul class="nav-list">
    {%- for node in first_level_pages -%}
        {%- assign node_url = node.url | remove: 'index.html' -%}
        {%- assign node_title = node.path | remove: 'index.md' | split: "/" | last | remove: '.md' | replace: "_pages", "Home" -%}
        {%- assign children_list = second_level_pages 
            | where_exp: "item", "item.url contains node_url" -%}
        {%- assign num_children = children_list | size -%}
        {%- if node_title != "Home" -%}
        <li id="nav-first" aria-label="{{ node_title }}">
            <div class="nav-item">
                <a href="{{ node_url | prepend: site.baseurl }}" class="nav-list-link nav-lh">
<!--                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M181.3 32.4c17.4 2.9 29.2 19.4 26.3 36.8L197.8 128h95.1l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3s29.2 19.4 26.3 36.8L357.8 128H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H347.1L325.8 320H384c17.7 0 32 14.3 32 32s-14.3 32-32 32H315.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8l9.8-58.7H155.1l-11.5 69.3c-2.9 17.4-19.4 29.2-36.8 26.3s-29.2-19.4-26.3-36.8L90.2 384H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l21.3-128H64c-17.7 0-32-14.3-32-32s14.3-32 32-32h68.9l11.5-69.3c2.9-17.4 19.4-29.2 36.8-26.3zM187.1 192L165.8 320h95.1l21.3-128H187.1z"/></svg>-->
                    <svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path  d="M219.645 21.475c-86.323 77.557-105.59 201.658-54.65 300.066-50.127-25.673-138.8-86.724-138.8-86.724 45.85 108.476 160.455 167.27 272.284 148.418-38.472 38.54-115.353 104.705-115.353 104.705 115.886-14.46 202.25-108.08 215.535-219.26 27.34 50.296 65.844 152.21 65.844 152.21 23.61-111.875-33.285-223.592-130.53-274.11 51.594-5.78 148.903-10.66 148.903-10.66-99.39-57.33-222.258-38.557-300.13 38.646 9.29-53.964 36.895-153.29 36.895-153.29zm58.146 133.713l8.468 16.66c-19.188 9.75-33.34 25.41-41.39 43.62 16.735-9.672 35.52-14.51 54.304-14.507 27.74.007 55.472 10.557 76.568 31.638l-13.21 13.218c-14.463-14.45-32.598-22.938-51.378-25.468 35.685 31.958 47.01 85.173 24.352 129.8l-16.664-8.46c10.288-20.263 12.17-42.564 6.93-62.94-17.864 45.488-65.192 74.762-115.713 67.762l2.566-18.512c20.953 2.903 41.172-1.655 58.006-11.64-3.377-.222-6.673-.75-9.853-1.58-44.683-8.246-81.18-44.32-87.76-91.66l18.51-2.573c3.092 22.242 14.056 41.433 29.696 55.135-10.657-47.194 11.486-97.58 56.568-120.493zm-3.626 73.238c-19.27 0-34.69 15.418-34.69 34.69 0 16.075 10.732 29.462 25.475 33.464 3.528.61 7.12 1.01 10.755 1.19 18.544-.798 33.15-15.9 33.15-34.653 0-19.273-15.42-34.69-34.69-34.69z"/></svg>

                    <span>{{ node_title }}</span>
                </a>
                {%- if num_children > 0 and node_url != "/" -%}
                <button class="nav-list-expander" aria-label="toggle items in {{ node_title }} category" aria-pressed="false">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/></svg>
                </button>
                {%- endif -%}
            </div>
            {%- if num_children > 0 and node_url != "/" -%}
            <ul class="nav-list">
            {%- for child in children_list -%}
                {%- assign child_url = child.url | remove: 'index.html' -%}
                {%- assign child_title = child.path | remove: 'index.md' | split: "/" | last | remove: '.md' -%}
                {%- assign grand_children_list = third_level_pages 
                    | where_exp: "item", "item.url contains child_url" -%}
                {%- assign num_grand_children = grand_children_list | size -%}
                <li id="nav-second" aria-label="{{ child_title }}">
                    <div class="nav-item">
                        <a href="{{ child_url | prepend: site.baseurl }}" class="nav-list-link nav-sh">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"/></svg>
                            <span>{{ child_title }}</span>
                        </a>
                        {%- if num_grand_children > 0 -%}
                        <button class="nav-list-expander" aria-label="toggle items in {{ child_title }} category" aria-pressed="false">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/></svg>
                        </button>
                        {%- endif -%}
                    </div>
                    {%- if num_grand_children > 0 -%}
                        <ul class="nav-list">
                        {%- for grand_child in grand_children_list -%}
                            {%- assign grand_child_title = grand_child.path | remove: 'index.md' | split: "/" | last | remove: '.md' -%}
                            <li id="nav-third" aria-label="{{ grand_child_title }}">
                                <div class="nav-item">
                                    <a href="{{ grand_child.url | prepend: site.baseurl }}" class="nav-list-link nav-sh">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M432 256c0 17.7-14.3 32-32 32L48 288c-17.7 0-32-14.3-32-32s14.3-32 32-32l352 0c17.7 0 32 14.3 32 32z"/></svg>
                                        <span>{{ grand_child_title }}</span>
                                    </a>
                                </div>
                            </li>
                        {%- endfor -%}
                        </ul>
                    {%- endif -%}
                </li>
            {%- endfor -%}
            </ul>
            {%- endif -%}
        </li>
        {%- endif -%}
    {%- endfor -%}
    </ul>
</nav>